# Production overrides for SafeSpace
services:
  safespace-app:
    environment:
      - APP_ENV=production
      - APP_DEBUG=false
      - NODE_OPTIONS=--max-old-space-size=2048
    deploy:
      resources:
        limits:
          memory: 1024M
        reservations:
          memory: 512M

  nginx:
    deploy:
      resources:
        limits:
          memory: 128M
        reservations:
          memory: 64M

  postgres:
    environment:
      - POSTGRES_INITDB_ARGS=--encoding=UTF-8 --lc-collate=C --lc-ctype=C
    deploy:
      resources:
        limits:
          memory: 256M
        reservations:
          memory: 128M

  redis:
    command: redis-server --appendonly yes --maxmemory 128mb --maxmemory-policy allkeys-lru
    deploy:
      resources:
        limits:
          memory: 128M
        reservations:
          memory: 64M
